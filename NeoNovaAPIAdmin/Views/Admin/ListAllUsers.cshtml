@using NeoNovaAPIAdmin.Models
@model List<AllUser>

@{
    Dictionary<string, List<AllUser>> roleToUsers = new Dictionary<string, List<AllUser>>();

    // Populate the dictionary by iterating over all users and their roles.
    foreach (var user in Model)
    {
        foreach (var role in user.Roles)
        {
            if (!roleToUsers.ContainsKey(role))
            {
                roleToUsers[role] = new List<AllUser>();
            }
            roleToUsers[role].Add(user);
        }
    }
}

<div class="text-center">
    <h1 class="display-4">List of All Users</h1>
    <p>Admin view of all registered users.</p>
</div>

<div class="container">
    @if (roleToUsers.Count == 0)
    {
        <h2>No Users</h2>
    }
    else
    {
        foreach (var kvp in roleToUsers)
        {
            var role = kvp.Key;
            var usersInRole = kvp.Value;

            <h2>@role Users (Total: @usersInRole.Count)</h2>

            if (usersInRole.Count == 0)
            {
                <p>No Users in this Role</p>
            }
            else
            {
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Roles</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in usersInRole)
                        {
                            <tr>
                                <td>@user.Id</td>
                                <td>@user.UserName</td>
                                <td>@user.Email</td>
                                <td>@string.Join(", ", user.Roles)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        }
    }
</div>
